pipeline {
     environment { 
        registry = "YourDockerhubAccount/YourRepository" registryCredential = 'cesarnttdata_dockerhub' dockerImage = 'usuarios:v1' 
        } 
        
        agent any 

        tools {

        maven "3.9.0"
        } 
        
        stages { 
            stage( 'Cloning our Git' ) { 
                steps { 
                    git 'https://github.com/CesarDevops/pipeline.git' 
                } 
            } 
            stage( 'Building our image' ) {
                 steps{ 
                    script {
                         dockerImage = docker.build registry + ": $BUILD_NUMBER " 
                        } 
                    } 
                } 
            stage( 'Deploy our image' ) {
                 steps{
                     script {
                         docker.withRegistry( 'cesarnttdata_dockerhub' , registryCredential ) {
                             dockerImage.push() 
                            } 
                        } 
                    } 
                } 
            stage( 'Cleaning up' ) {
                 steps{
                     sh "docker rmi $registry : $BUILD_NUMBER " 
                    }
            } 
        }
}